# タワーディフェンスゲーム

HTML + CSS + JavaScript（Vanilla）で実装したブラウザベースのタワーディフェンスゲームです。

## 🎮 ゲーム概要

10×10マスのフィールド上で、スタート地点からゴール（基地）へ向かってくる敵を、タワーを配置して撃退するタワーディフェンスゲームです。

### 主な特徴

- **完全なVanilla JavaScript実装**：React等のフレームワーク不要
- **静的ホスティング対応**：GitHub Pages / Netlify / Vercel等で簡単にデプロイ可能
- **Canvas 2D レンダリング**：軽量で高速な描画
- **2種類のタワー**：剣士（近接）とアーチャー（遠隔）
- **8方向/4方向スプライト対応**：タワーが敵の方向を向く
- **5ステージ構成**：ステージをクリアするごとに難易度が上昇
- **ウェーブクリアシステム**：各Wave完了時に3秒間の待機時間とクリア表示
- **マルチウェーブ**：各ステージ2-3のウェーブで構成
- **タワーアップグレード機能**：建設済みタワーをクリックしてレベルアップ
- **ゲーム速度調整**：×0.5、×1.0、×2.0の3段階

### ゲームルール

1. **初期ゴールド（G）**を使ってタワーを建設
2. **5種類の敵**（スライム、ゴブリン、盗賊、ゴーレム、魔王）がスタート地点から出現
3. **タワー**が自動的に射程内の敵を攻撃
4. 敵を倒すと**報酬G**を獲得
5. 敵が**基地（ゴール）**に到達すると基地を攻撃
6. **基地HPが0**になるとゲームオーバー
7. **全ウェーブをクリア**するとステージクリア、次のステージへ進行
8. **ステージ5をクリア**するとゲーム完全制覇

## 📁 ファイル構成

```
tower_diffence_game/
├── README.md                   # このファイル
├── public/
│   ├── index.html              # エントリーポイント
│   └── assets/
│       └── sprites/            # ゲーム画像
│           ├── ally/
│           │   ├── archer/     # アーチャー8方向（u,d,l,r,lu,ld,ru,rd）
│           │   ├── solder/     # 剣士4方向（u,d,l,r）
│           │   └── tower.png   # 基地画像
│           └── enemy/
│               ├── slime.png
│               ├── goblin.png
│               ├── thief.png
│               ├── golem.png
│               └── demon_king.png
└── src/
    ├── main.js                 # メインゲームロジック
    ├── core/                   # コアシステム
    │   ├── engine.js           # ゲームループ・タイミング管理
    │   ├── renderer.js         # Canvas描画ユーティリティ
    │   ├── assetLoader.js      # 画像読み込み
    │   └── input.js            # マウス入力管理
    └── game/                   # ゲームロジック
        ├── map.js              # マップ・パス定義
        ├── entities.js         # エンティティ基底クラス
        ├── enemy.js            # 敵ロジック（5種類）
        ├── tower.js            # タワー・弾ロジック（2種類）
        ├── base.js             # 基地ロジック
        ├── wave.js             # ウェーブ管理
        ├── economy.js          # ゴールド管理
        ├── stage.js            # ステージ進行管理（5ステージ）
        ├── ui.js               # UI描画
        └── save.js             # セーブ/ロード（予約）
```

## 🚀 起動方法

### 必要要件

- モダンブラウザ（Chrome / Firefox / Safari / Edge 最新版）
- ローカルサーバー（CORS制限のため）

### 起動手順

#### 方法1: Python 3 を使用（推奨）

```bash
# プロジェクトルートディレクトリへ移動
cd /path/to/tower_diffence_game

# Pythonの簡易HTTPサーバーを起動
python3 -m http.server 8000

# ブラウザでアクセス
# http://localhost:8000/public/
```

#### 方法2: VS Code Live Server拡張機能

1. VS Codeに「Live Server」拡張機能をインストール
2. `public/index.html` を右クリック
3. 「Open with Live Server」を選択

#### 方法3: npx（Node.js環境）

```bash
# プロジェクトルートディレクトリで実行
npx serve public -p 8000

# ブラウザでアクセス
# http://localhost:8000/
```

## 🎯 ゲームシステム詳細

### タワータイプ

#### 剣士（Solder）
- **コスト**: 30G
- **アップグレードコスト**: 20G
- **射程**: 120px
- **攻撃速度**: 1.5発/秒
- **ダメージ**: 5.5
- **特徴**: 近接型、4方向スプライト、赤い×エフェクト攻撃

#### アーチャー（Archer）
- **コスト**: 40G
- **アップグレードコスト**: 30G
- **射程**: 160px
- **攻撃速度**: 2.2発/秒
- **ダメージ**: 4
- **特徴**: 遠隔型、8方向スプライト、矢を発射

### 敵タイプ

#### スライム（Slime）
- **HP**: 30
- **速度**: 60 px/秒
- **報酬**: 5G
- **基地ダメージ**: 1/秒

#### ゴブリン（Goblin）
- **HP**: 45
- **速度**: 80 px/秒
- **報酬**: 8G
- **基地ダメージ**: 2/秒

#### 盗賊（Thief）
- **HP**: 60
- **速度**: 120 px/秒（高速）
- **報酬**: 10G
- **基地ダメージ**: 1/秒

#### ゴーレム（Golem）
- **HP**: 500（高耐久）
- **速度**: 40 px/秒（低速）
- **報酬**: 20G
- **基地ダメージ**: 3/秒

#### 魔王（Demon King）
- **HP**: 1800（最終ボス）
- **速度**: 50 px/秒
- **報酬**: 100G
- **基地ダメージ**: 5/秒

### ステージ構成

| ステージ | 初期G | ウェーブ数 | 主な敵 | クリア報酬 |
|---------|-------|-----------|--------|-----------|
| 1 | 100 | 2 | スライム | 30G |
| 2 | 継承 | 3 | スライム、ゴブリン | 40G |
| 3 | 継承 | 3 | スライム、ゴブリン、盗賊 | 50G |
| 4 | 継承 | 3 | ゴブリン、盗賊、ゴーレム | 80G |
| 5 | 継承 | 3 | 魔王 | 200G |

### UI構成

- **画面右サイドバー**: ゴールド、基地HP、ステージ、Wave、速度変更ボタン
- **画面下部HUD**: タワー選択ボタン（剣士・アーチャー）
- **ホバー時表示**: 建設コスト、アップグレードコスト、攻撃範囲
- **敵情報**: HP数値とHPバーが常に最前面に表示

### ゲーム進行

1. **ステージ開始**: 2秒後に最初の敵が出現
2. **Wave完了**: 全敵撃破後「Wave X Clear!!!」表示
3. **Wave間待機**: 現実時間3秒（ゲーム速度に影響されない）
4. **次Wave開始**: カウントダウン後、自動的に次Waveへ
5. **ステージクリア**: 最終Wave完了後、ボーナスG獲得

## 🕹️ 操作方法

### マウス操作

- **左クリック（空きタイル）**: タワーを建設
- **左クリック（建設済みタイル）**: タワーをアップグレード
- **ホバー**: コスト・攻撃範囲の表示

### 画面UI

- **速度ボタン（右サイドバー）**: ゲーム速度切り替え（×0.5/×1.0/×2.0）
- **タワー選択（下部HUD）**: 剣士またはアーチャーを選択

## 🛠️ 技術スタック

- **HTML5 Canvas**: レンダリング
- **ES Modules**: モジュール管理
- **requestAnimationFrame**: ゲームループ（60FPS）
- **Vanilla JavaScript**: フレームワーク不使用

### 主要アルゴリズム

- **パス追従**: ウェイポイント配列 + 線形補間
- **ターゲティング**: 最近接優先（Nearest）アルゴリズム
- **衝突判定**: 円形（Circle vs Circle）
- **描画最適化**: レイヤー分離（スプライト→HPバー→UI）
- **時間管理**: Wave Clear待機は現実時間（Date.now()）ベース

### コード設計

- **モジュラー構造**: 機能ごとにファイル分割
- **ES6クラス**: オブジェクト指向設計
- **状態管理**: GAME_STATE による明確な状態遷移
- **レンダラー分離**: 描画ロジックを Renderer クラスに集約

## 📝 カスタマイズガイド

### タワーの調整

`src/game/tower.js` の `TOWER_TYPES` を編集：

```javascript
export const TOWER_TYPES = {
  archer: {
    cost: 40,           // 建設コスト
    upgradeCost: 30,    // アップグレードコスト
    range: 160,         // 射程（ピクセル）
    fireRate: 2.2,      // 攻撃速度（発/秒）
    damage: 4,          // ダメージ
    // ...
  }
};
```

### 敵の調整

`src/game/enemy.js` の `ENEMY_TYPES` を編集：

```javascript
export const ENEMY_TYPES = {
  slime: {
    hp: 30,            // 体力
    speed: 60,         // 移動速度（px/秒）
    bounty: 5,         // 撃破報酬
    attackDamage: 1,   // 基地へのダメージ
    // ...
  }
};
```

### ステージの調整

`src/game/stage.js` の `initializeStages()` を編集：

```javascript
1: {
  startGold: 100,                    // 初期ゴールド
  waves: [
    {
      delay: 2.0,                    // Wave開始遅延（秒）
      enemies: [
        { type: 'slime', n: 10, interval: 0.8 }  // 敵タイプ、数、出現間隔
      ]
    }
  ],
  clearBonusGold: 30                 // クリアボーナス
}
```

### Wave Clear待機時間の調整

`src/game/wave.js` の18行目：

```javascript
this.waveClearDelay = 3000; // ミリ秒単位（現実時間）
```

### マップ経路の調整

`src/game/map.js` の `path` 配列を編集：

```javascript
export const path = [
  { x: -1, y: 1 },  // 画面外スタート
  { x: 0, y: 1 },
  // ... 経路を追加
  { x: 9, y: 4 }    // ゴール
];
```

## 🎨 アセットについて

- キャラクター画像は ChatGPT と Google AI Studio（Nano-banana）で生成しています。
- 効果音（SE）は `https://soundeffect-lab.info/` からダウンロードして使用しています。
- BGM は Suno AI でオリジナル楽曲を生成しています。

## 📄 ライセンス

このプロジェクトは学習・セミナー用途で作成されています。

---

**Happy Tower Defense! 🏰⚔️🛡️**
